!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).wabi=e()}(this,function(){"use strict";function t(t,e,n){return e+t()*(n-e)}function e(t){return null==t?Math.random:function(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}(t)}function n(t,e,n,s){return 0===e||3===e?Math.max(0,Math.min(t,2*s)):Math.max(n-2*s,Math.min(t,n))}function s(t,e,n,s){return 0===e||1===e?Math.max(0,Math.min(t,2*s)):Math.max(n-2*s,Math.min(t,n))}function i(e,n,s,i){const{points:o=0,edgeWobble:r=0,distribution:a="random"}=s;if(o<=0||0===r)return[];const l=function(t,e,n){let s;switch(e){case"even":s=[];for(let e=1;e<=t;e++)s.push(e/(t+1));break;case"weighted-center":s=[];for(let e=0;e<t;e++){const t=.5+.6*(n()-.5);s.push(Math.max(.1,Math.min(.9,t)))}s.sort((t,e)=>t-e);break;default:s=[];for(let e=0;e<t;e++)s.push(.1+.8*n());s.sort((t,e)=>t-e)}return s}(o,a,i),h=n.x-e.x,u=n.y-e.y,c=Math.sqrt(h*h+u*u),p=-u/c,d=h/c;return l.map(n=>{const s=e.x+n*h,o=e.y+n*u,a=t(i,-r,r);return{x:s+a*p,y:o+a*d}})}function o(o,r,a){const{corners:l={x:0,y:0},edges:h={points:0,edgeWobble:0},cutCorners:u=0,cornerChamfer:c=1,seed:p=null}=a,d=e(p),m=function(e,i,o,r){const{x:a=0,y:l=0,independent:h=!0}=o,u=[{x:0,y:0},{x:e,y:0},{x:e,y:i},{x:0,y:i}];if(0===a&&0===l)return u;if(h)return u.map((o,h)=>{const u=t(r,-a,a),c=t(r,-l,l);return{x:n(o.x+u,h,e,a),y:s(o.y+c,h,i,l)}});{const o=t(r,-a,a),h=t(r,-l,l);return u.map((t,r)=>({x:n(t.x+o,r,e,a),y:s(t.y+h,r,i,l)}))}}(o,r,l,d);let f=function(t,e,n){const{points:s=0}=e;if(s<=0)return t;const o=[];for(let s=0;s<t.length;s++){const r=t[s],a=t[(s+1)%t.length];o.push(r);const l=i(r,a,e,n);o.push(...l)}return o}(m,h,d);if(u>0){const t=function(t,e){if(t<=0)return new Set;if(t>=4)return new Set([0,1,2,3]);const n=[0,1,2,3],s=new Set;for(let i=0;i<t;i++){const t=Math.floor(e()*n.length);s.add(n[t]),n.splice(t,1)}return s}(u,d),e=(h.points||0)+1,n=c??1;n>=1?f=f.filter((n,s)=>{const i=Math.floor(s/e);return!(s%e===0&&t.has(i))}):n>0&&(f=f.map((s,i)=>{const o=Math.floor(i/e);if(i%e===0&&t.has(o)){const t=(i-1+f.length)%f.length,e=(i+1)%f.length,o=f[t],r=f[e],a={x:(o.x+r.x)/2,y:(o.y+r.y)/2};return{x:s.x+(a.x-s.x)*n,y:s.y+(a.y-s.y)*n}}return s}))}return f}const r={x:5,y:4,independent:!0},a={points:0,edgeWobble:3,distribution:"random"},l=0,h=1,u=null,c=null,p="%",d=!0;function m(t){let e=u;return!1===t.shadow?e=!1:t.shadow&&"object"==typeof t.shadow&&(e=t.shadow),{corners:{...r,...t.corners||{}},edges:{...a,...t.edges||{}},cutCorners:void 0!==t.cutCorners?t.cutCorners:l,cornerChamfer:void 0!==t.cornerChamfer?t.cornerChamfer:h,shadow:e,seed:void 0!==t.seed?t.seed:c,units:t.units||p,preserveOnResize:void 0!==t.preserveOnResize?t.preserveOnResize:d}}function f(t,e){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>t.apply(this,s),e)}}let y=null;const w=new WeakMap;let g=null;const b=new Set;function x(t){for(const e of t){const t=w.get(e.target);t&&t(e)}}function R(){b.forEach(t=>t())}const v={x:0,y:4,blur:8,color:"rgba(0,0,0,0.15)"};const C=new class{constructor(){this.wrappers=new WeakMap}wrap(t,e,n){const s=window.getComputedStyle(t);if("fixed"===s.position||"absolute"===s.position)return console.warn("wabi.js: Shadow not supported for position:fixed/absolute elements",t),null;let i=this.wrappers.get(t);return i||(i=document.createElement("div"),i.className="wabi-shadow-wrapper",n.wrapperClass&&i.classList.add(n.wrapperClass),t.parentNode&&t.parentNode.insertBefore(i,t),i.appendChild(t),this.wrappers.set(t,i)),i.style.filter=e,this.syncStyles(t,i),i}syncStyles(t,e){const n=window.getComputedStyle(t);["display","position","top","right","bottom","left","float","clear","zIndex","flex","flexGrow","flexShrink","flexBasis","alignSelf","justifySelf","gridArea","gridColumn","gridRow","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","order","marginTop","marginRight","marginBottom","marginLeft"].forEach(t=>{e.style[t]=n[t]}),t.style.margin="0","absolute"!==n.position&&"fixed"!==n.position||(t.style.position="static",t.style.top="auto",t.style.right="auto",t.style.bottom="auto",t.style.left="auto")}unwrap(t){const e=this.wrappers.get(t);e&&(t.style.margin="",t.style.position="",t.style.top="",t.style.right="",t.style.bottom="",t.style.left="",e.parentNode&&e.parentNode.insertBefore(t,e),e.remove(),this.wrappers.delete(t))}};const S=new class{constructor(){this.items=new Set,this.isRunning=!1,this.frameId=null,this.lastTime=0}add(t){this.items.add(t),!this.isRunning&&this.items.size>0&&this.start()}remove(t){this.items.delete(t),this.isRunning&&0===this.items.size&&this.stop()}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.frameId=requestAnimationFrame(this.tick.bind(this)))}stop(){this.isRunning=!1,this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null)}tick(t){if(!this.isRunning)return;const e=t-this.lastTime;this.lastTime=t,this.items.forEach(t=>{t.update&&t.update(e)}),this.frameId=requestAnimationFrame(this.tick.bind(this))}},E=Symbol("wabi.instance");class M{constructor(t,e){this.element=t,this.options=e,this.originalStart={clipPath:t.style.clipPath,filter:t.style.filter,transition:t.style.transition},this.cleanups=[],this.isFirstRender=!0,this.lastAspectRatio=0,this.originalStart.clipPath&&"none"!==this.originalStart.clipPath&&console.warn("wabi.js: Existing clip-path will be overwritten.",t),this.init()}init(){this.resizeCleanup=function(t,e,n={}){const{bypassDebounceOnce:s=!1}=n;if("undefined"!=typeof ResizeObserver){y||(y=new ResizeObserver(f(x,20)));const n=f(e,100);let i=!1;const o=s?t=>{i?n(t):(i=!0,e(t))}:n;return w.set(t,o),y.observe(t),()=>{y.unobserve(t),w.delete(t)}}g||(g=f(R,100),window.addEventListener("resize",g));const i=f(e,100),o=s?(()=>{let t=!1;return()=>{t?i():(t=!0,e())}})():i;return b.add(o),()=>{b.delete(o),0===b.size&&g&&(window.removeEventListener("resize",g),g=null)}}(this.element,()=>this.handleResize(),{bypassDebounceOnce:this.isFirstRender}),this.cleanups.push(this.resizeCleanup);const t=this.element.offsetWidth,e=this.element.offsetHeight;t>1&&e>1&&(this.update(),this.isFirstRender=!1),this.updateShadow()}handleResize(){if("%"===this.options.units){const t=this.element.offsetWidth/this.element.offsetHeight;if(isFinite(this.lastAspectRatio)||(this.lastAspectRatio=0),0===this.lastAspectRatio&&isFinite(t)&&t>0)return this.lastAspectRatio=t,this.isFirstRender=!1,void this.update();Math.abs(t-this.lastAspectRatio)/this.lastAspectRatio>.01&&(this.lastAspectRatio=t,this.update())}else"px"===this.options.units&&this.update()}updateShadow(){const t=function(t){if(!t||!1===t)return null;const{x:e=v.x,y:n=v.y,blur:s=v.blur,color:i=v.color}=t;return`drop-shadow(${e}px ${n}px ${s}px ${i})`}(this.options.shadow);t?C.wrap(this.element,t,this.options):C.unwrap(this.element)}update(){let t;if("%"===this.options.units){const e=this.element.offsetWidth,n=this.element.offsetHeight,s=Math.sqrt(e*n),i=e/s*100,r=n/s*100;t=o(i,r,this.options),t=t.map(t=>({x:t.x/i*100,y:t.y/r*100}))}else t=o(this.element.offsetWidth,this.element.offsetHeight,this.options);const e=function(t,e="%"){return`polygon(${t.map(t=>function(t,e,n){return"px"===n?`${t.toFixed(2)}px ${e.toFixed(2)}px`:`${t.toFixed(2)}% ${e.toFixed(2)}%`}(t.x,t.y,e)).join(", ")})`}(t,this.options.units),n=this.element.style.transition;this.element.style.transition="none",this.element.style.clipPath=e,this.element.offsetHeight,this.element.style.transition=n}setOptions(t){this.options=m({...this.options,...t}),this.update(),this.updateShadow()}restore(){C.unwrap(this.element),this.element.style.clipPath=this.originalStart.clipPath,this.cleanups.forEach(t=>t()),this.cleanups=[]}}class I{constructor(t,e,n,s){if(this.elements=function(t){return Array.isArray(t)?t.filter(t=>t instanceof Element):t instanceof Element?[t]:t instanceof NodeList||t instanceof HTMLCollection?Array.from(t):"string"==typeof t?Array.from(document.querySelectorAll(t)):[]}(t),this.wabiElements=[],0===this.elements.length)return;let i;if("object"==typeof e&&null!==e)i=m(e);else{const o=function(t){if(2===t.length&&"number"==typeof t[1])return{corners:{x:t[1],y:t[1]}};if(t.length>=3&&"number"==typeof t[1]&&"number"==typeof t[2]){const e={corners:{x:t[1],y:t[2]}};return t.length>=4&&"number"==typeof t[3]&&(e.edges={points:t[3]}),e}return{}}([t,e,n,s]);i=m(o)}this.wabiElements=this.elements.map(t=>{t[E]&&t[E].restore();const e=new M(t,i);return t[E]=e,e}),this.animationItem=null}update(){this.wabiElements.forEach(t=>t.update())}restore(){this.stop(),this.wabiElements.forEach(t=>{t.restore(),delete t.element[E]}),this.wabiElements=[]}setOptions(t){this.wabiElements.forEach(e=>{const n=e.options,s={...n,...t,corners:{...n.corners,...t.corners||{}},edges:{...n.edges,...t.edges||{}},cutCorners:t.cutCorners??n.cutCorners,cornerChamfer:t.cornerChamfer??n.cornerChamfer};!1===t.shadow?s.shadow=!1:t.shadow&&"object"==typeof t.shadow&&(s.shadow={...n.shadow||{},...t.shadow}),e.setOptions(m(s))})}animate(t={}){const e=t.interval??100;this.animationItem&&S.remove(this.animationItem),this.animationItem={elapsed:0,interval:e,update:t=>{this.animationItem.elapsed+=t,this.animationItem.elapsed>=this.animationItem.interval&&(this.update(),this.animationItem.elapsed=0)}},S.add(this.animationItem)}stop(){this.animationItem&&(S.remove(this.animationItem),this.animationItem=null)}get isAnimating(){return!!this.animationItem}static apply(t,e,...n){const s=new I(t,e,...n);return s.wabiElements.length>0&&"object"==typeof e&&e.animate&&s.animate("object"==typeof e.animate?e.animate:{}),s}}return function(t,e,n,s){return I.apply(t,e,n,s)}});
